<div class="container">
  <div>
    <h5 class="font-semibold">CARRITO DE COMPRA</h5>
    <hr />
  </div>

  <!-- Tabla -->
  <div class="flex overflow-x-auto mt-5">
    <div class="mat-elevation-z1 w-full">
      <table mat-table [dataSource]="dataSource" matSort>
        <ng-container matColumnDef="id">
          <th mat-header-cell *matHeaderCellDef mat-sort-header>#</th>
          <td mat-cell *matCellDef="let row; let i = index">{{ i + 1 }}</td>
        </ng-container>

        <ng-container matColumnDef="codigo">
          <th mat-header-cell *matHeaderCellDef mat-sort-header>
            Código
          </th>
          <td mat-cell *matCellDef="let row">{{ row.producto.codigo }}</td>
        </ng-container>

        <ng-container matColumnDef="nombre">
          <th mat-header-cell *matHeaderCellDef mat-sort-header>Nombre</th>
          <td mat-cell *matCellDef="let row">{{ row.producto.nombre }}</td>
        </ng-container>

        <ng-container matColumnDef="precio">
          <th mat-header-cell *matHeaderCellDef mat-sort-header>Precio</th>
          <td mat-cell *matCellDef="let row">{{ row.producto.precio }}</td>
        </ng-container>

        <ng-container matColumnDef="cantidad">
          <th mat-header-cell *matHeaderCellDef mat-sort-header>Cantidad</th>
          <td mat-cell *matCellDef="let row">{{ row.cantidad }}</td>
        </ng-container>

        <ng-container matColumnDef="categoria">
          <th mat-header-cell *matHeaderCellDef mat-sort-header>Categoría</th>
          <td mat-cell *matCellDef="let row">{{ row.producto.nombre }}</td>
        </ng-container>

        <ng-container matColumnDef="imagen">
          <th mat-header-cell *matHeaderCellDef mat-sort-header>Imagen</th>
          <td mat-cell *matCellDef="let row">
            <div class="p-2">
              <img class="max-w-30 max-h-30 border" src="{{row.producto.url}}" alt="">
            </div>
          </td>
        </ng-container>

        <ng-container matColumnDef="acciones">
          <th mat-header-cell *matHeaderCellDef mat-sort-header class="!text-end">Acciones</th>
          <td mat-cell *matCellDef="let row">
            <div class="flex justify-end gap-1">

              <button class="!text-c_danger hover:!scale-125" mat-icon-button
                matTooltip="Quitar del carrito" (click)="onClickEliminar(row)">
                <mat-icon class="mat-18">close</mat-icon>
              </button>
            </div>
          </td>
        </ng-container>

        <tr mat-header-row *matHeaderRowDef="displayedColumns"></tr>
        <tr mat-row *matRowDef="let row; columns: displayedColumns"></tr>

        <!-- No data -->
        <tr class="mat-row" *matNoDataRow>
          <td class="mat-cell p-3" colspan="4">(No hay registros)</td>
        </tr>
      </table>

      <mat-paginator [pageSizeOptions]="[5, 10, 25, 100]"></mat-paginator>
    </div>
  </div>

  <div class="mt-5" *ngIf="productos.length > 0">
    <div [formGroup]="form">
      <div class="flex flex-col">
        <div class="w-full">
          <p class="text-2xl">Total a pagar: <strong>S/.{{ total }}</strong> </p>
        </div>

        <div class="w-full pr-1 pb-1 mt-3">
          <mat-form-field class="w-full">
            <mat-label>Método de pago</mat-label>
            <mat-select formControlName="metodo">
              <mat-option *ngFor="let item of metodos" [value]="item.id">{{ item.tipo }}</mat-option>
            </mat-select>
            <mat-error *ngIf="frmValidationUtils?.hasErrors('metodo')"
              [innerHtml]="frmValidationUtils.getErrorMessages('metodo', 'Método')"></mat-error>
          </mat-form-field>
        </div>

        <div class="text-end">
          <button mat-flat-button class="!bg-minjus_success !text-white !text-lg" (click)="onClickPagar()">
            Finalizar Compra
          </button>
        </div>
      </div>
    </div>
  </div>

</div>
